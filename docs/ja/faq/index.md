# よくある質問

## WebUI

### WebUIアドレス

デフォルトポートは7892です。サーバーデプロイメントの場合は`http://serverhost:7892`に、ローカルデプロイメントの場合は`http://localhost:7892`にアクセスします。ポートを変更した場合は、Dockerのポートマッピングも更新することを忘れないでください。

### デフォルトのユーザー名とパスワード

- デフォルトのユーザー名：`admin`、デフォルトのパスワード：`adminadmin`
- 初回ログイン後にパスワードを変更してください。

### パスワードの変更またはリセット

- パスワード変更：ログイン後、右上の`···`をクリックし、`プロファイル`をクリックして、ユーザー名とパスワードを変更します。
- 現在、簡単なパスワードリセット方法はありません。パスワードを忘れた場合は、`data/data.db`ファイルを削除して再起動してください。

### 設定変更が反映されないのはなぜですか？

- 設定変更後、**適用**ボタンをクリックし、次に`···`メニューの**再起動**をクリックしてメインプロセスを再起動します。
- デバッグモードが有効な場合は、`···`メニューの**シャットダウン**をクリックしてコンテナを再起動します。

### プログラムが正常に動作しているか確認する方法

新しいWebUIには右上に小さなドットがあります。緑は正常に動作中、赤はエラーが発生してプログラムが一時停止中を意味します。

### ポスターウォールに画像が表示されない

- バージョン3.0の場合：
    ABはデフォルトで`mikanani.me`アドレスをポスター画像ソースとして使用します。画像が表示されない場合、ネットワークがこれらの画像にアクセスできません。
- バージョン3.1以降の場合：
  - ポスターにエラーアイコンが表示される場合、画像がありません。右上メニューのポスター更新ボタンをクリックしてTMDBポスターを取得してください。
  - ポスターの読み込みに失敗する場合は、ブラウザのキャッシュをクリアしてください。
  - RSSアドレスとして`mikanime.tv`を使用している場合、クライアント側のプロキシがポスターの読み込みを妨げる可能性があります。`direct`ルールを追加してください。

## v3.0はどのようにアニメを管理しますか

v3.0にアップグレード後、ABはWebUIでアニメトレントとダウンロードルールを管理できます。トレントのダウンロードパスとルール名に依存します。
QBでトレントのダウンロードパスを手動で変更すると、通知にポスターがない、トレントの削除に失敗するなどの問題が発生する可能性があります。
できるだけAB内でアニメとトレントを管理してください。

## ダウンロードとキーワードフィルタリング

### ダウンロードパス

**ダウンロードパスには何を入力すればよいですか？**
- このパラメータはqBittorrentの設定と一致させるだけです：
  - Docker：qBが`/downloads`を使用している場合は、`/downloads/Bangumi`に設定します。`Bangumi`は任意の名前に変更できます。
  - Linux/macOS：`/home/usr/downloads`または`/User/UserName/Downloads`の場合は、末尾に`/Bangumi`を追加するだけです。
  - Windows：`D:\Media\`を`D:\Media\Bangumi`に変更します

### ダウンロードが自動的に開始されない

AutoBangumiのログでトレント関連のエントリを確認してください。
- 存在しない場合は、購読が正しいか確認してください。

### ダウンロードが正しいディレクトリに保存されない

- [ダウンロードパス](#ダウンロードパス)が正しいか確認してください。
- qBittorrentのPGIDとPUID設定でフォルダ作成権限を確認してください。任意のトレントを指定ディレクトリに手動でダウンロードしてみてください — エラーが発生するかディレクトリが作成されない場合は、権限の問題です。
- qBittorrentのデフォルト設定を確認してください：保存管理は手動に設定する必要があります（保存管理 >> デフォルトトレント管理モード >> 手動）。

### 購読していないアニメが多数ダウンロードされる

- Mikan購読が単一のアニメのすべての字幕グループを含んでいないか確認してください。アニメごとに1つのグループのみを購読し、詳細購読を有効にしてください。
  - 詳細購読はMikan Projectのユーザー設定で有効にできます。
- 正規表現フィルタリングが不十分な場合があります — 正規表現の拡張については次のセクションを参照してください。
- どちらにも該当しない場合は、ログとともに[Issues][ISSUE]で報告してください。

### フィルターキーワードの書き方

ABのフィルターキーワードは正規表現で、ルール作成時にのみ追加されます。作成後にルールを拡張するには、WebUI（v3.0以降）を使用して各アニメを個別に設定します。
- フィルターキーワードは正規表現です — 不要なキーワードは`|`で区切ります。
- デフォルトの`720|\d+-\d+`ルールは、すべてのコレクションと720Pアニメをフィルタリングします。ABをデプロイする前にフィルターを追加してください。以降の環境変数の変更は新しいルールにのみ影響します。
- 一般的な正規表現キーワード（`|`で区切り）：
  - `720` — 720、720P、720pなどをフィルタリング
  - `\d+-\d+` — [1-12]のようなコレクションをフィルタリング
  - `[Bb]aha` — Bahaリリースをフィルタリング
  - `[Bb]ilibili`、`[Bb]-Global` — Bilibiliリリースをフィルタリング
  - `繁`、`CHT` — 繁体字中国語字幕をフィルタリング
- 特定のキーワードに一致させるには、QBのincludeフィールドに追加：`XXXXX+1080P\+`ここで`1080P\+`は1080P+リリースに一致します。

### 初回デプロイ時に不要なアニメがダウンロードされた

1. QBで余分な自動ダウンロードルールとファイルを削除します。
2. 購読とフィルタールールを確認します。
3. ブラウザでresetRule APIにアクセス：`http://localhost:7892/api/v1/resetRule`でルールをリセットします。
4. ABを再起動します。

### ABが購読より少ないRSSエントリを識別する

新しいバージョンでは、ABのフィルターもデフォルトですべてのRSSエントリをフィルタリングします。すべてのフィルターを一度に追加しないでください。細かい制御には、WebUIで各アニメを個別に設定してください。

### フィルターキーワードが機能しない

- **グローバルフィルター**パラメータが正しく設定されているか確認してください。
- QBのRSS自動ダウンロードルールを確認してください — 右側で一致したRSSを確認でき、ダウンロードルールを調整して保存をクリックすると、どのキーワードが問題を引き起こしているかを特定できます。

## エピソード補完

### エピソード補完が機能しない

**エピソード補完**パラメータが正しく設定されているか確認してください。

## ファイルリネーム

### 解析エラー `Cannot parse XXX`

- ABは現在コレクションの解析をサポートしていません。
- コレクションでない場合は、GitHub Issuesで問題を報告してください。

### `Rename failed`またはリネームエラー

- ファイルパスを確認してください。標準的な保存パスは`/title/Season/Episode.mp4`である必要があります。非標準のパスは名前付けエラーの原因となります — qBittorrentの設定を確認してください。
- `ダウンロードパス`が正しく入力されているか確認してください。パスが正しくないと適切なリネームができません。
- その他の問題については、GitHub Issuesで報告してください。

### 自動リネームされない

- QBのトレントカテゴリが`Bangumi`であるか確認してください。
- ABはダウンロード済みのファイルのみをリネームします。

### AB以外のアニメをABでリネームする方法

- トレントのカテゴリを`Bangumi`に変更するだけです。
- 注意：リネームをトリガーするには、トレントが`Title/Season X/`フォルダに保存されている必要があります。

### コレクションのリネーム方法

1. コレクションのカテゴリを`Bangumi`に変更します。
2. コレクションの保存パスを`Title/Season X/`に変更します。
3. コレクションのダウンロードが完了するのを待つと、リネームが完了します。

## Docker

### 自動更新の方法

Dockerで`watchtower`デーモンを実行して、コンテナを自動的に更新します。

[watchtower](https://containrrr.dev/watchtower) 公式ドキュメント

### Docker Composeでの更新

ABがDocker Composeでデプロイされている場合は、`docker compose pull`で更新します。
新しいイメージをpullした後、`docker compose up -d`で再起動します。

`docker-compose.yml`に`pull_policy: always`を追加すると、起動するたびに最新のイメージをpullできます。

### アップグレードで問題が発生した場合の対処法

設定が異なる場合があるため、アップグレードによりプログラムが失敗する可能性があります。この場合、以前のデータと生成された設定ファイルをすべて削除してから、コンテナを再起動してください。
その後、WebUIで再設定します。
古いバージョンからアップグレードする場合は、まず[アップグレードガイド](/ja/changelog/2.6)を参照してください。

上記でカバーされていない問題が発生した場合は、バグテンプレートを使用して[Issues][ISSUE]で報告してください。


[ISSUE]: https://github.com/EstrellaXD/Auto_Bangumi/issues
