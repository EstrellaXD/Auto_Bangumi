# 常见问题

## WebUI

### WebUI 地址

默认端口为 7892。服务器部署时访问 `http://serverhost:7892`，本地部署时访问 `http://localhost:7892`。如果修改了端口，请记得同时修改 Docker 端口映射。

### 默认用户名和密码

- 默认用户名：`admin`，默认密码：`adminadmin`。
- 请在首次登录后修改密码。

### 修改或重置密码

- 修改密码：登录后，点击右上角的 `···`，点击 `个人资料`，即可修改用户名和密码。
- 目前没有简便的密码重置方法。如果忘记密码，请删除 `data/data.db` 文件后重启。

### 为什么配置修改不生效？

- 修改配置后，点击 **应用** 按钮，然后在 `···` 菜单中点击 **重启** 来重启主程序。
- 如果启用了调试模式，请在 `···` 菜单中点击 **关闭** 来重启容器。

### 如何检查程序是否正常运行

新版 WebUI 右上角有一个小圆点。绿色表示程序正常运行，红色表示发生错误且程序已暂停。

### 海报墙不显示图片

- 如果您的版本是 3.0：
    AB 默认使用 `mikanani.me` 地址作为海报图片来源。如果图片不显示，说明您的网络无法访问这些图片。
- 如果您的版本是 3.1 或更高版本：
  - 如果海报显示错误图标，说明图片缺失。请点击右上角菜单中的刷新海报按钮来获取 TMDB 海报。
  - 如果海报加载失败，请清除浏览器缓存。
  - 使用 `mikanime.tv` 作为 RSS 地址时，客户端代理可能会阻止海报加载。请为其添加 `direct` 规则。

## v3.0 如何管理番剧

升级到 v3.0 后，AB 可以在 WebUI 中管理番剧种子和下载规则。这依赖于种子下载路径和规则名称。
如果您在 QB 中手动修改了种子下载路径，可能会遇到通知缺少海报或种子删除失败等问题。
请尽量在 AB 内管理番剧和种子。

## 下载与关键词过滤

### 下载路径

**下载路径应该填什么？**
- 这个参数只需要与您的 qBittorrent 配置匹配即可：
  - Docker：如果 qB 使用 `/downloads`，则设置为 `/downloads/Bangumi`。您可以将 `Bangumi` 改为任何名称。
  - Linux/macOS：如果是 `/home/usr/downloads` 或 `/User/UserName/Downloads`，只需在末尾添加 `/Bangumi`。
  - Windows：将 `D:\Media\` 改为 `D:\Media\Bangumi`

### 下载没有自动开始

检查 AutoBangumi 的日志中是否有种子相关的条目。
- 如果没有，请检查您的订阅是否正确。

### 下载没有保存到正确的目录

- 检查[下载路径](#下载路径)是否正确。
- 检查 qBittorrent 的 PGID 和 PUID 配置是否有创建文件夹的权限。尝试手动下载任意种子到指定目录——如果出错或目录未创建，则是权限问题。
- 检查 qBittorrent 的默认设置：保存管理应设置为手动（保存管理 >> 默认 Torrent 管理模式 >> 手动）。

### 下载了很多未订阅的番剧

- 检查您的 Mikan 订阅是否包含了同一番剧的所有字幕组。每个番剧只订阅一个字幕组，并启用高级订阅。
  - 高级订阅可以在 Mikan Project 的用户设置中启用。
- 正则表达式过滤可能不够——请参阅下一节来扩展正则表达式。
- 如果以上都不适用，请携带日志在 [Issues][ISSUE] 报告。

### 如何编写过滤关键词

AB 中的过滤关键词是正则表达式，仅在创建规则时添加。要在创建后扩展规则，请使用 WebUI（v3.0+）单独配置每个番剧。
- 过滤关键词是正则表达式——用 `|` 分隔不需要的关键词。
- 默认的 `720|\d+-\d+` 规则会过滤掉所有合集和 720P 番剧。在部署 AB 前添加过滤器；之后的环境变量修改只影响新规则。
- 常用正则表达式关键词（用 `|` 分隔）：
  - `720` — 过滤 720、720P、720p 等。
  - `\d+-\d+` — 过滤 [1-12] 等合集
  - `[Bb]aha` — 过滤 Baha 发布
  - `[Bb]ilibili`、`[Bb]-Global` — 过滤 Bilibili 发布
  - `繁`、`CHT` — 过滤繁体中文字幕
- 要匹配特定关键词，请在 QB 的包含字段中添加：`XXXXX+1080P\+`，其中 `1080P\+` 匹配 1080P+ 发布。

### 首次部署时下载了不想要的番剧

1. 删除 QB 中多余的自动下载规则和文件。
2. 检查订阅和过滤规则。
3. 在浏览器中访问 resetRule API：`http://localhost:7892/api/v1/resetRule` 来重置规则。
4. 重启 AB。

### AB 识别的 RSS 条目比订阅的少

在较新版本中，AB 的过滤器默认也会过滤所有 RSS 条目。不要一次添加所有过滤器。要进行细粒度控制，请在 WebUI 中单独配置每个番剧。

### 过滤关键词不生效

- 检查 **全局过滤器** 参数是否设置正确。
- 检查 QB 的 RSS 自动下载规则——您可以在右侧看到匹配的 RSS，调整下载规则并点击保存来确定是哪个关键词导致问题。

## 剧集补全

### 剧集补全不生效

检查 **剧集补全** 参数是否配置正确。

## 文件重命名

### 解析错误 `Cannot parse XXX`

- AB 目前不支持解析合集。
- 如果不是合集，请在 GitHub Issues 上报告问题。

### `Rename failed` 或重命名错误

- 检查文件路径。标准存储路径应为 `/title/Season/Episode.mp4`。非标准路径会导致命名错误——请检查您的 qBittorrent 配置。
- 检查 `下载路径` 是否填写正确。路径不正确会导致无法正确重命名。
- 其他问题请在 GitHub Issues 上报告。

### 没有自动重命名

- 检查 QB 中的种子分类是否为 `Bangumi`。
- AB 只会重命名已下载的文件。

### 如何使用 AB 重命名非 AB 下载的番剧

- 只需将种子的分类改为 `Bangumi`。
- 注意：种子必须存储在 `Title/Season X/` 文件夹中才能触发重命名。

### 如何重命名合集

1. 将合集的分类改为 `Bangumi`。
2. 将合集的存储路径改为 `Title/Season X/`。
3. 等待合集下载完成，重命名将自动完成。

## Docker

### 如何自动更新

在 Docker 中运行 `watchtower` 守护进程来自动更新您的容器。

[watchtower](https://containrrr.dev/watchtower) 官方文档

### 使用 Docker Compose 更新

如果您的 AB 是使用 Docker Compose 部署的，请使用 `docker compose pull` 来更新。
拉取新镜像后，使用 `docker compose up -d` 来重启。

您也可以在 `docker-compose.yml` 中添加 `pull_policy: always` 来在每次启动时拉取最新镜像。

### 升级导致问题怎么办

由于配置可能各不相同，升级可能会导致程序失败。在这种情况下，删除所有之前的数据和生成的配置文件，然后重启容器。
然后在 WebUI 中重新配置。
如果从旧版本升级，请先参阅[升级指南](/changelog/2.6)。

如果您遇到上述未涵盖的问题，请使用 bug 模板在 [Issues][ISSUE] 报告。


[ISSUE]: https://github.com/EstrellaXD/Auto_Bangumi/issues
