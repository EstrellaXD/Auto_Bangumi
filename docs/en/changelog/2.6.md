# [2.6] Release Notes

## Upgrade Notes from Older Versions

Starting from version 2.6, AutoBangumi (AB) configuration has moved from environment variables to `config.json`. Note the following before upgrading.

### Environment Variable Migration

Old environment variables are automatically converted to `config.json` on the first startup after upgrading to 2.6. The generated `config.json` is placed in the `/app/config` folder.
Once you've mapped the `/app/config` folder, old environment variables no longer affect AB's operation. You can delete `config.json` to regenerate from environment variables.

### Container Volume Mapping

After version 2.6, the following folders need to be mapped:

- `/app/config`: Configuration folder containing `config.json`
- `/app/data`: Data folder containing `bangumi.json`, etc.

### Data Files

Due to major updates, we don't recommend using old data files. AB will automatically generate a new `bangumi.json` in `/app/data`.

Don't worry â€” QB won't re-download previously downloaded anime.

### Subsequent Configuration Changes

AB can now edit configuration directly in the WebUI. After editing, restart the container for changes to take effect.

## How to Upgrade

### Docker Compose

You can use your existing docker-compose.yml file to upgrade:

```bash
docker compose stop autobangumi
docker compose pull autobangumi
```

Then modify docker-compose.yml to add volume mappings:

```yaml
version: "3.8"

services:
  autobangumi:
    image: estrellaxd/auto_bangumi:latest
    container_name: autobangumi
    restart: unless-stopped
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Asia/Shanghai
    volumes:
      - /path/to/config:/app/config
      - /path/to/data:/app/data
    networks:
      - bridge
    dns:
      - 8.8.8.8
```

Then start AB:

```bash
docker compose up -d autobangumi
```

### Portainer

In Portainer, modify the volume mappings and click `Recreate` to complete the upgrade.

### What to do if the upgrade causes issues

Since configurations may vary, upgrades might cause the program to fail. Delete all previous data and generated configuration files, then restart the container and reconfigure in the WebUI.


## New Features

### Configuration Method Change

After v2.6, program configuration has moved from Docker environment variables to `config.json`.
The new WebUI also provides a web-based configuration editor. Access the AB URL and find `Settings` in the sidebar to modify configuration. Restart the container after editing.

### Custom Reverse Proxy URL and AB as Proxy Relay

To handle situations where [Mikan Project](https://mikanani.me) is inaccessible, AB provides three approaches:

1. HTTP and SOCKS Proxy

    This feature existed in older versions. After upgrading to 2.6, just check the proxy configuration in the WebUI to access Mikan Project normally.

    However, qBittorrent still can't access Mikan's RSS and torrent URLs directly, so you need to add a proxy in qBittorrent as well. See #198 for details.

2. Custom Reverse Proxy URL

    Version 2.6 added a `custom_url` option for custom reverse proxy URLs.
    Set it to your properly configured reverse proxy URL. AB will use this custom URL to access Mikan Project, and QB can download normally.

3. AB as Proxy Relay

    After configuring a proxy in AB, AB can serve as a local proxy relay (currently only for RSS-related functions).
    Set `custom_url` to `http://abhost:abport` where `abhost` is AB's IP and `abport` is AB's port.
    AB will push its own address to qBittorrent, which will use AB as a proxy to access Mikan Project.

    Note: If you haven't set up a reverse proxy for AB with Nginx or similar, include `http://` to ensure proper operation.

**Important Notes**

If AB and QB are in the same container, don't use `127.0.0.1` or `localhost` as they can't communicate this way.
If on the same network, use container name addressing, e.g., `http://autobangumi:7892`.

You can also use the Docker gateway address, e.g., `http://172.17.0.1:7892`.

If on different hosts, use the host machine's IP address.

### Collection and Folder Renaming

AB can now rename files within collections and folders, moving media files back to the root directory.
Note that AB still relies on the save path to determine season and episode information, so place collection files according to AB's standard.

After version **2.6.4**, AB can rename subtitles within folders (feature still being refined). Collections and subtitles default to `pn` format renaming; adjustment options are not yet available.

**Standard Path**

```
/downloads/Bangumi/Title/Season 1/xxx
```

### Push Notifications

AB can now send rename completion notifications via `Telegram` and `ServerChan`.

In the WebUI, enable push notifications and fill in the required parameters.

- Telegram requires Bot Token and Chat ID. Refer to various tutorials for obtaining these.
- ServerChan requires a Token. Refer to various tutorials for obtaining this.
